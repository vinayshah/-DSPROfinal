<?php

namespace Biztech\Manufacturer\Controller\Adminhtml\Manufacturer;

class Edit extends \Magento\Backend\App\Action {

	protected $_manufacturerModel;
	protected $_manufacturertextModel;
	protected $_coreRegistry = null;
	protected $resultPageFactory;

	public function __construct(
		\Magento\Backend\App\Action\Context $context,
		\Biztech\Manufacturer\Model\Manufacturer $manufacturerModel,
		\Biztech\Manufacturer\Model\Manufacturertext $manufacturertextModel,
		\Magento\Framework\View\Result\PageFactory $resultPageFactory,
		\Magento\Framework\Registry $registry
	) {
		$this->_manufacturerModel     = $manufacturerModel;
		$this->_manufacturertextModel = $manufacturertextModel;
		$this->resultPageFactory      = $resultPageFactory;
		$this->_coreRegistry          = $registry;
		parent::__construct($context);
	}
	/**
	 * @var \Magento\Framework\View\Result\PageFactory
	 */
	public function execute() {

		$store = $this->getRequest()->getParam('store', 0);
		$id    = $this->getRequest()->getParam('manufacturer_id');
		$model = $this->_manufacturerModel;
		if ($id) {
			$model->load($id);
			if (!$model->getId()) {
				$this->messageManager->addError(__('Manufacturer No Longer Exists'));
				$resultRedirect = $this->resultRedirectFactory->create();
				$this->_redirect('*/*/', array('store' => $store));
				return $resultRedirect->setPath('*/*/');
			}
		}
		$model->load($id);
		$modelText = $this->_manufacturertextModel->getCollection()
		                  ->addFieldToFilter('store_id', $store)
		                  ->addFieldToFilter('manufacturer_id', $model->getManufacturerId());

		$data = $this->_getSession()->getFormData(true);
		if (!empty($data)) {
			$model->setData($data);
			if ($modelText->count()) {
				$modelText->setData($data);
			}
		}
		if ($modelText->count()) {
			$model_text = $modelText->getData();
			$text_data  = $model_text[0];
		} else {
			$text_data = array();
		}
		$model->addData($text_data);

		$this->_coreRegistry->register('manufacturer_grid', $model);

		$this->_view->loadLayout();

		$this->_view->getLayout()->initMessages();
		$this->_view->renderLayout();

	}

}
